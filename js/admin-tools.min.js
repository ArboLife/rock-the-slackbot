(function($){"use strict";$(document).ready(function(){$(".rts-tooltip").tooltip();$(".rts-field.rts-field-required").each(function(){var $rts_field_td=$(this);$rts_field_td.find(".rts-input-required").on("keyup change",function(){if($(this).val()!=""){$rts_field_td.removeClass("rts-field-error").removeClass("rts-field-is-blank")}else{$rts_field_td.addClass("rts-field-error").addClass("rts-field-is-blank")}})});var $rts_webhook_url_input=$("#rts-webhook-url-input");rts_check_webhook_url_input();var $rts_webhook_url_typing_timer;var $rts_webhook_url_typing_interval=500;$rts_webhook_url_input.on("keyup",function(){clearTimeout($rts_webhook_url_typing_timer);$rts_webhook_url_typing_timer=setTimeout(rts_check_webhook_url_input,$rts_webhook_url_typing_interval)});$rts_webhook_url_input.on("keydown",function(){clearTimeout($rts_webhook_url_typing_timer)});$rts_webhook_url_input.on("change",function(){rts_check_webhook_url_input()});$(".rts-close-thickbox").on("click",function($event){$event.preventDefault();tb_remove();setTimeout(rts_reset_test_webhook_url_popup,1e3)});$(document).on("keyup",function($event){if($event.keyCode==27){rts_reset_test_webhook_url_popup()}});$("#rts-test-webhook-url-init").on("click",function($event){$event.preventDefault();rts_test_webhook_url($rts_webhook_url_input.val())});$(".rts-events .rts-event-choice").each(function(){var $event_choice=$(this);$event_choice.rts_check_event_choice();$(this).find(".rts-event-choice-active-field").on("change",function(){$event_choice.rts_check_event_choice()})});$("#rts-select-all-events").on("click",function($event){$event.preventDefault();if($(this).hasClass("all-selected")){$(this).removeClass("all-selected");$(".rts-events .rts-event-choice .rts-event-choice-active-field").prop("checked",false).trigger("change")}else{$(this).addClass("all-selected");$(".rts-events .rts-event-choice .rts-event-choice-active-field").prop("checked",true).trigger("change")}});$("#rock-slackbot-delete-button").on("click",function($event){var $confirm=confirm(rock_the_slackbot.delete_webhook_conf);if($confirm!=true){$event.preventDefault()}})});function rts_test_webhook_url($webhook_url){rts_reset_test_webhook_url_popup();$("#rts-test-webhook-url-init").width($("#rts-test-webhook-url-init").width()).height($("#rts-test-webhook-url-init").height()).addClass("loading");var $response_message=null;var $test_worked=false;$.ajax({url:ajaxurl,type:"POST",dataType:"json",async:true,cache:false,data:{action:"test_webhook_url",webhook_url:$webhook_url,channel:$("#rts-webhook-channel").val()},success:function($response){if($response.error!==undefined&&$response.error!=""){$test_worked=false;$response_message=rock_the_slackbot.webhook_test_responses.error+$response.error}else if($response.sent!==undefined&&$response.sent>0){$test_worked=true;$response_message=rock_the_slackbot.webhook_test_responses.success}else{$test_worked=false;$response_message=rock_the_slackbot.webhook_test_responses.failed}},complete:function($jqXHR,$textStatus){var $response_message_span=null;if($test_worked){$response_message_span=$('<span class="rts-response rts-response-success">'+$response_message+"</span>");$("#rts-test-webhook-url-init").removeClass("button-primary");$("#rts-test-webhook-url-close").html(rock_the_slackbot.close)}else{$response_message_span=$('<span class="rts-response rts-response-fail">'+$response_message+"</span>")}$("#rts-popup-test-webhook-message").append(" ").append($response_message_span);$("#rts-test-webhook-url-init").html("<span>"+rock_the_slackbot.webhook_send_another+"</span>");$("#rts-test-webhook-url-init").removeClass("loading").removeAttr("style")}})}function rts_check_webhook_url_input(){var $rts_webhook_url_input=$("#rts-webhook-url-input");var $rts_field_td=$rts_webhook_url_input.closest(".rts-field");var $input_button_combo=$rts_webhook_url_input.closest(".rts-input-button-combo");if($rts_webhook_url_input.val().match(/^http/i)){$rts_field_td.removeClass("rts-field-error").removeClass("rts-field-is-invalid");$input_button_combo.addClass("show-button")}else{$input_button_combo.removeClass("show-button");if($rts_webhook_url_input.val()!=""){$rts_field_td.addClass("rts-field-error").addClass("rts-field-is-invalid")}else{$rts_field_td.removeClass("rts-field-is-invalid")}}}function rts_reset_test_webhook_url_popup(){var $popup=$("#rts-popup-test-webhook-url");$popup.find(".rts-response").remove();$("#rts-test-webhook-url-init").html("<span>"+rock_the_slackbot.webhook_send_test+"</span>").addClass("button-primary");$("#rts-test-webhook-url-close").html(rock_the_slackbot.cancel)}$.fn.rts_check_event_choice=function(){var $active_field=$(this).find(".rts-event-choice-active-field");if($active_field.is(":checked")){$(this).addClass("rts-choice-is-active")}else{$(this).removeClass("rts-choice-is-active")}}})(jQuery);